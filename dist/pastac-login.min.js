"use strict";function PastacLoginController(e,o){function n(){if(t.loggedInMenuItems=[],t.loggedOutMenuItems=[],t.extraMenuItems){console.log("extraMenuItems="+t.extraMenuItems);var e=t.extraMenuItems.split(",");console.log(typeof e),e.forEach(function(e){console.log("item="+e),e=e.trim();var o=!1,n=!1;e.startsWith("+")?(o=!0,e=e.substring(1)):e.startsWith("-")&&(n=!0,e=e.substring(1)),o||n||(o=!0,n=!0),console.log("item="+e);var r=e.indexOf(":");if(console.log("pos="+r),r>=0)var a=e.substring(0,r),s=e.substring(r+1);else a=e,s=e;o&&t.loggedInMenuItems.push({tag:a,label:s}),n&&t.loggedOutMenuItems.push({tag:a,label:s})})}console.log(" in: ",t.loggedInMenuItems),console.log("out: ",t.loggedOutMenuItems)}var t=this,r=!0,a=null;t.$onInit=function(){console.log("ctrl=",t),t.loggedIn=!1,t.mode="login",t.setMode=function(e){t.mode=e},t.validatingUsername=!1,t.usernameErrorMessage="",a=t.handler,n(),authservice.init({host:t.config.host,port:t.config.port,tenant:t.config.tenant,version:t.config.version,pretend:t.config.pretend,bindToDOM:t.bindToDOM,onUserChange:function(e,n,a){if(a&&t.freshCredentials)return console.log("pastac-login: Reloading stale user details (came from cookie)"),r=!1,authservice.reloadUser();t.user=e,console.log("pastac-login: setting user:",e),t.handler?t.handler.onUserChange?o(function(){t.handler.onUserChange(e,n,a)},1):console.log("pastac-login: NOT calling handler.onUserChange (handler.onUserChange not defined)"):console.log("pastac-login: NOT calling handler.onUserChange (handler not defined)")}}),t.initiateOAuth2=function(e){if(t.error){t.error}else;var o=location.protocol+"//"+location.hostname+(location.port?":"+location.port:""),n=t.resume?o+t.resume:Authservice.currentPageURL(),r=Authservice.bounceURL("/bower_components/pastac-login/dist/bounce.html",n);console.log("bounceURL="+r);var a={authority:e,resume:r};a.error=t.error?o+t.error:a.resumeURL,authservice.initiateOAuth2(a)},t.doEmailSignin=function(){console.log("doEmailSignin("+t.email+", "+t.password+")");var e=t.password;t.password="",t.loginError="",authservice.login(t.email,e,function(e){o(function(){t.email="",$("#pastac-login-modal").modal("hide"),$("#pastac-login-navbar-dropdown").dropdown("toggle")},100)},function(e){o(function(){t.loginError=e},100)})},t.doLogout=function(){authservice.logout(),t.email="",t.password=""},t.validateUsername=function(){if(""==t.register_username)return void(t.usernameErrorMessage="");t.validatingUsername=!0,t.usernameErrorMessage="",Authservice.usernameAvailability(t.register_username,function(e){o(function(){t.usernameErrorMessage=e,t.validatingUsername=!1},1)},function(){alert("Communications error: unable to determine if this username is available"),t.usernameErrorMessage=null,t.validatingUsername=!1})},t.doRegister=function(){if(!t.usernameErrorMessage){var e=location.protocol+"//"+location.hostname+(location.port?":"+location.port:""),n=t.registerResume?e+t.registerResume:Authservice.currentPageURL(),r=Authservice.bounceURL("/bower_components/pastac-login/dist/bounce.html",n);console.log("bounceURL="+r);var e=location.protocol+"//"+location.hostname+(location.port?":"+location.port:""),a={email:t.register_email,resume:r};t.loginWithUsername&&t.register_username&&(a.username=t.register_username),t.registerWithField("password")&&(a.password=t.register_password),t.registerWithField("first_name")&&(a.first_name=t.register_first_name),t.registerWithField("middle_name")&&(a.middle_name=t.register_middle_name),t.registerWithField("last_name")&&(a.last_name=t.register_last_name),t.register_password="",console.log("doRegister()",a),t.registerInProgress=!0,authservice.register(a,function(e){o(function(){t.registerInProgress=!1,t.mode="login",$("#pastac-login-navbar-dropdown").dropdown("toggle"),$("#pastac-login-modal").modal("hide"),alert("You have been Registered. Please check your email.")},10)},function(e){o(function(){t.registerInProgress=!1,alert("Could not register: "+e)},10)})}},t.registerWithField=function(e){if(t.registerFields)for(var o=t.registerFields.split(","),n=0;n<o.length;n++)if(o[n].trim()==e)return!0;return!1},t.doForgot=function(){var e=location.protocol+"//"+location.hostname+(location.port?":"+location.port:""),n=t.forgotResume?e+t.forgotResume:Authservice.currentPageURL(),r=Authservice.bounceURL("/bower_components/pastac-login/dist/bounce.html",n);console.log("bounceURL="+r);var e=location.protocol+"//"+location.hostname+(location.port?":"+location.port:""),a={email:t.forgot_email,resume:r};console.log("doForgot()",a),t.forgotInProgress=!0,authservice.forgot(a,function(){o(function(){t.forgotInProgress=!1,t.mode="login",$("#pastac-login-navbar-dropdown").dropdown("toggle"),$("#pastac-login-modal").modal("hide"),alert("You have been sent a password reset email. Please check your email.")},10)},function(e){o(function(){t.forgotInProgress=!1,alert("Could not send forgotten password email: "+e)},10)})},t.onMenuItem=function(e){console.log("onMenuItem("+e+")"),t.handler?t.handler.onMenuItem?o(function(){t.handler.onMenuItem(e)},1):console.log("pastac-login: NOT calling handler.onMenuItem (handler.onMenuItem not defined)"):console.log("pastac-login: NOT calling handler.onMenuItem (handler not defined)")}},t.$onChanges=function(e){console.log("$onChanges()"),n()}}angular.module("pastac-login",[]).component("pastacLogin",{controller:PastacLoginController,controllerAs:"ctrl",bindings:{config:"<",handler:"=",template:"<",freshCredentials:"<",loginWithUsername:"<",signin:"<",hideRegister:"<",hideForgot:"<",hideAvatar:"<",hideLogout:"<",bindToDom:"<",extraMenuItems:"<",registerFields:"<",registerResume:"<",forgotResume:"<",facebook:"<",google:"<",github:"<",resume:"<",fail:"<"},templateUrl:function(e,o){var n="/bower_components/pastac-login/dist/pastac-login-navbar.html";if(o.template)switch(o.template){case"invisible":n="/bower_components/pastac-login/dist/pastac-login-invisible.html";break;case"user":n="/bower_components/pastac-login/dist/pastac-login-user.html";break;case"navbar":n="/bower_components/pastac-login/dist/pastac-login-navbar.html";break;case"modal":n="/bower_components/pastac-login/dist/pastac-login-modal.html";break;case"page":n="/bower_components/pastac-login/dist/pastac-login-page.html";break;default:n=o.template}return console.log("pastac-login: template: "+n),n}}).component("pastacUserDetails",{controller:PastacLoginController,controllerAs:"ctrl",bindings:{config:"<",handler:"=",template:"<",freshCredentials:"<",signin:"<",hideRegister:"<",hideForgot:"<",hideAvatar:"<",hideLogout:"<",registerFields:"<",registerResume:"<",facebook:"<",google:"<",github:"<",resume:"<",fail:"<"},templateUrl:function(e,o){var n="/bower_components/pastac-login/dist/pastac-login-navbar.html";if(o.template)switch(o.template){case"invisible":n="/bower_components/pastac-login/dist/pastac-login-invisible.html";break;case"user":n="/bower_components/pastac-login/dist/pastac-login-user.html";break;case"navbar":n="/bower_components/pastac-login/dist/pastac-login-navbar.html";break;case"modal":n="/bower_components/pastac-login/dist/pastac-login-modal.html";break;case"page":n="/bower_components/pastac-login/dist/pastac-login-page.html";break;default:n=o.template}return console.log("pastac-login: template: "+n),n}});